{"ts": "2026-02-09T00:40:37Z", "session_id": "full_prompt_parity_20260209a_test_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_4dc14db539a4", "content": "Write tests for baseline mode markers and context manifest fields."}
{"ts": "2026-02-09T00:40:37Z", "session_id": "full_prompt_parity_20260209a_test_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_4dc14db539a4", "content": "{\"summary\":\"Write tests for baseline mode markers and context manifest fields.\",\"project\":{\"language\":\"python\"},\"files\":[{\"path\":\"tests/test_context_manifest.py\",\"content\":\"\\\"\\\"\\\"Tests for baseline mode markers and context manifest fields.\\\"\\\"\\\"\\n\\nfrom __future__ import annotations\\n\\nimport importlib.util\\nimport sys\\nfrom pathlib import Path\\n\\n\\ndef _load_cli_module():\\n    root = Path(__file__).resolve().parents[1]\\n    cli_path = root / \\\"scripts\\\" / \\\"elephant_cli.py\\\"\\n    spec = importlib.util.spec_from_file_location(\\\"elephant_cli_local\\\", cli_path)\\n    if spec is None or spec.loader is None:\\n        raise RuntimeError(\\\"Unable to load scripts/elephant_cli.py\\\")\\n    module = importlib.util.module_from_spec(spec)\\n    sys.modules[spec.name] = module\\n    spec.loader.exec_module(module)\\n    return module\\n\\n\\nelephant_cli = _load_cli_module()\\n\\n\\ndef test_baseline_mode_marker_in_response(tmp_path: Path, monkeypatch):\\n    (tmp_path / \\\"pyproject.toml\\\").write_text(\\\"[project]\\\\nname='tmp'\\\\n\\\", encoding=\\\"utf-8\\\")\\n    monkeypatch.setenv(\\\"ELEPHANT_PROJECT_ROOT\\\", str(tmp_path))\\n    args = elephant_cli._parse([\\\"plan\\\", \\\"--cwd\\\", str(tmp_path), \\\"--task\\\", \\\"add feature\\\", \\\"--output\\\", \\\"json\\\"])\\n    code, response = elephant_cli.execute_command(args)\\n\\n    assert code == 0\\n    assert response[\\\"ok\\\"] is True\\n    assert \\\"baseline_mode\\\" in response\\n    assert isinstance(response[\\\"baseline_mode\\\"], bool)\\n\\n\\ndef test_context_manifest_fields_in_response(tmp_path: Path, monkeypatch):\\n    (tmp_path / \\\"pyproject.toml\\\").write_text(\\\"[project]\\\\nname='tmp'\\\\n\\\", encoding=\\\"utf-8\\\")\\n    monkeypatch.setenv(\\\"ELEPHANT_PROJECT_ROOT\\\", str(tmp_path))\\n    args = elephant_cli._parse([\\\"plan\\\", \\\"--cwd\\\", str(tmp_path), \\\"--task\\\", \\\"add feature\\\", \\\"--output\\\", \\\"json\\\"])\\n    code, response = elephant_cli.execute_command(args)\\n\\n    assert code == 0\\n    assert response[\\\"ok\\\"] is True\\n    assert \\\"context_manifest\\\" in response\\n    manifest = response[\\\"context_manifest\\\"]\\n    assert isinstance(manifest, dict)\\n    assert \\\"vsa_structure\\\" in manifest\\n    assert \\\"top_modalities\\\" in manifest[\\\"vsa_structure\\\"]\\n    assert \\\"bundle_similarity_to_task\\\" in manifest[\\\"vsa_structure\\\"]\\n    assert \\\"task_fingerprint\\\" in manifest[\\\"vsa_structure\\\"]\\n    assert \\\"bundle_fingerprint\\\" in manifest[\\\"vsa_structure\\\"]\\n    assert \\\"index_files_scanned\\\" in manifest\\n    assert \\\"index_edges_total\\\" in manifest\\n    assert \\\"world_model_enabled\\\" in manifest\\n\\n\\ndef test_baseline_mode_false_for_normal_plan(tmp_path: Path, monkeypatch):\\n    (tmp_path / \\\"pyproject.toml\\\").write_text(\\\"[project]\\\\nname='tmp'\\\\n\\\", encoding=\\\"utf-8\\\")\\n    monkeypatch.setenv(\\\"ELEPHANT_PROJECT_ROOT\\\", str(tmp_path))\\n    args = elephant_cli._parse([\\\"plan\\\", \\\"--cwd\\\", str(tmp_path), \\\"--task\\\", \\\"add feature\\\", \\\"--output\\\", \\\"json\\\"])\\n    code, response = elephant_cli.execute_command(args)\\n\\n    assert code == 0\\n    assert response[\\\"baseline_mode\\\"] is False\\n\\n\\ndef test_context_manifest_contains_impacted_files(tmp_path: Path, monkeypatch):\\n    (tmp_path / \\\"pyproject.toml\\\").write_text(\\\"[project]\\\\nname='tmp'\\\\n\\\", encoding=\\\"utf-8\\\")\\n    monkeypatch.setenv(\\\"ELEPHANT_PROJECT_ROOT\\\", str(tmp_path))\\n    args = elephant_cli._parse([\\\"plan\\\", \\\"--cwd\\\", str(tmp_path), \\\"--task\\\", \\\"add feature\\\", \\\"--output\\\", \\\"json\\\"])\\n    code, response = elephant_cli.execute_command(args)\\n\\n    assert code == 0\\n    assert response[\\\"ok\\\"] is True\\n    manifest = response[\\\"context_manifest\\\"]\\n    assert \\\"impacted_files\\\" in manifest\\n    assert isinstance(manifest[\\\"impacted_files\\\"], list)\\n\\n\\ndef test_context_manifest_contains_git_diff_summary(tmp_path: Path, monkeypatch):\\n    (tmp_path / \\\"pyproject.toml\\\").write_text(\\\"[project]\\\\nname='tmp'\\\\n\\\", encoding=\\\"utf-8\\\")\\n    monkeypatch.setenv(\\\"ELEPHANT_PROJECT_ROOT\\\", str(tmp_path))\\n    args = elephant_cli._parse([\\\"plan\\\", \\\"--cwd\\\", str(tmp_path), \\\"--task\\\", \\\"add feature\\\", \\\"--output\\\", \\\"json\\\"])\\n    code, response = elephant_cli.execute_command(args)\\n\\n    assert code == 0\\n    assert response[\\\"ok\\\"] is True\\n    manifest = response[\\\"context_manifest\\\"]\\n    assert \\\"git_diff_summary\\\" in manifest\\n    assert isinstance(manifest[\\\"git_diff_summary\\\"], dict)\\n    assert \\\"lines_added\\\" in manifest[\\\"git_diff_summary\\\"]\\n    assert \\\"lines_deleted\\\" in manifest[\\\"git_diff_summary\\\"]\\n\"}],\"dependencies\":{\"dependencies\":{},\"devDependencies\":{},\"python\":[\"pytest==8.3.4\"],\"pythonDev\":[\"pytest==8.3.4\"],\"rust\":[],\"go\":[],\"cpp\":[]},\"commands\":[\"pytest tests/test_context_manifest.py -v\"]}"}
