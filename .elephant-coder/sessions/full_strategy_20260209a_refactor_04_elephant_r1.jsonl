{"ts": "2026-02-09T00:24:16Z", "session_id": "full_strategy_20260209a_refactor_04_elephant_r1", "role": "user", "command": "/code", "run_id": "run_eea2cf4a5156", "content": "Refactor persona parsing helpers to simplify classification and sanitization rules."}
{"ts": "2026-02-09T00:24:16Z", "session_id": "full_strategy_20260209a_refactor_04_elephant_r1", "role": "assistant", "command": "/code", "run_id": "run_eea2cf4a5156", "content": "{\"summary\": \"Refactor persona parsing helpers to simplify classification and sanitization rules.\", \"project\": {\"language\": \"python\"}, \"files\": [{\"path\": \"elephant_coder/persona_utils.py\", \"content\": \"\\\"\\\"\\\"Persona parsing helpers for classification and sanitization.\\\"\\\"\\\"\\n\\nfrom __future__ import annotations\\n\\nimport re\\nfrom typing import NamedTuple\\n\\n\\nclass PersonaRule(NamedTuple):\\n    \\\"\\\"\\\"Single persona classification rule.\\\"\\\"\\\"\\n    pattern: str\\n    label: str\\n\\n\\nclass PersonaClassifier:\\n    \\\"\\\"\\\"Simple persona classifier based on regex rules.\\\"\\\"\\\"\\n\\n    def __init__(self, rules: list[PersonaRule] | None = None) -> None:\\n        self._rules = rules or []\\n\\n    def add_rule(self, pattern: str, label: str) -> None:\\n        \\\"\\\"\\\"Add a classification rule.\\\"\\\"\\\"\\n        self._rules.append(PersonaRule(pattern, label))\\n\\n    def classify(self, text: str) -> str:\\n        \\\"\\\"\\\"Return the first matching label or 'unknown'.\\\"\\\"\\\"\\n        for rule in self._rules:\\n            if re.search(rule.pattern, text, re.IGNORECASE):\\n                return rule.label\\n        return \\\"unknown\\\"\\n\\n\\ndef sanitize_id(text: str) -> str:\\n    \\\"\\\"\\\"Sanitize text for use as an identifier.\\n\\n    Raises ValueError if sanitized result is empty.\\n    \\\"\\\"\\\"\\n    sanitized = re.sub(r\\\"[^a-z0-9_]+\\\", \\\"_\\\", text.lower())\\n    sanitized = re.sub(r\\\"_+\\\", \\\"_\\\", sanitized).strip(\\\"_\\\")\\n    if not sanitized:\\n        raise ValueError(\\\"Sanitized ID is empty\\\")\\n    return sanitized\\n\"}], \"dependencies\": {\"dependencies\": {}, \"devDependencies\": {}, \"python\": [], \"pythonDev\": [], \"rust\": [], \"go\": [], \"cpp\": []}, \"commands\": [\"python -m pytest tests/test_personas.py -v\"]}"}
