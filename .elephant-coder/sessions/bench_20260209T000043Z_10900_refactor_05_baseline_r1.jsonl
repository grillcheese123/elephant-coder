{"ts": "2026-02-09T00:07:57Z", "session_id": "bench_20260209T000043Z_10900_refactor_05_baseline_r1", "role": "user", "command": "/code", "run_id": "run_b24dffcf676c", "content": "Refactor stats metrics calculation into focused helpers with stable return shapes."}
{"ts": "2026-02-09T00:07:57Z", "session_id": "bench_20260209T000043Z_10900_refactor_05_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_b24dffcf676c", "content": "{\"summary\": \"Refactor index_stats and related metrics helpers into focused, stable-return helpers to improve maintainability and testability.\", \"project\": {\"language\": \"python\"}, \"files\": [{\"path\": \"elephant_coder/index_engine.py\", \"content\": \"def _stats_files_indexed(index: IndexService) -> int:\\n    meta = index._store.get_indexed_file_meta()\\n    return len(meta)\\n\\n\\ndef _stats_symbols_total(index: IndexService) -> int:\\n    symbols = index._store.list_symbols()\\n    return len(symbols)\\n\\n\\ndef _stats_edges_total(index: IndexService) -> int:\\n    edges = index._store.list_edges()\\n    return len(edges)\\n\\n\\ndef _stats_impact_depth(index: IndexService, max_depth: int = 3) -> dict[str, int]:\\n    \\\"\\\"\\\"Return impact propagation statistics up to max_depth.\\\"\\\"\\\"\\n    meta = index._store.get_indexed_file_meta()\\n    if not meta:\\n        return {\\\"max_depth\\\": 0, \\\"files_at_depth\\\": {}}\\n    first_file = next(iter(meta.keys()))\\n    impact = index.impact_for_files([first_file], max_depth=max_depth)\\n    files_at_depth: dict[str, int] = {}\\n    for item in impact.get(\\\"impacted\\\", []):\\n        depth = item.get(\\\"depth\\\", 0)\\n        key = str(depth)\\n        files_at_depth[key] = files_at_depth.get(key, 0) + 1\\n    return {\\\"max_depth\\\": max_depth, \\\"files_at_depth\\\": files_at_depth}\\n\\n\\ndef _stats_metrics(index: IndexService) -> dict[str, Any]:\\n    \\\"\\\"\\\"Stable metrics shape for stats command.\\\"\\\"\\\"\\n    return {\\n        \\\"files_indexed\\\": _stats_files_indexed(index),\\n        \\\"symbols_total\\\": _stats_symbols_total(index),\\n        \\\"edges_total\\\": _stats_edges_total(index),\\n        \\\"impact_depth\\\": _stats_impact_depth(index),\\n    }\\n\\n\\ndef index_stats(self) -> dict[str, int]:\\n    \\\"\\\"\\\"Return basic index counts.\\\"\\\"\\\"\\n    metrics = _stats_metrics(self)\\n    return {\\n        \\\"files_scanned\\\": metrics[\\\"files_indexed\\\"],\\n        \\\"symbols_total\\\": metrics[\\\"symbols_total\\\"],\\n        \\\"edges_total\\\": metrics[\\\"edges_total\\\"],\\n    }\"}, {\"path\": \"scripts/elephant_cli.py\", \"content\": \"def _command_stats(project_root: Path) -> dict[str, Any]:\\n    \\\"\\\"\\\"Stats command handler with stable metrics shape.\\\"\\\"\\\"\\n    svc = _new_index_service(project_root)\\n    try:\\n        metrics = _stats_metrics(svc)\\n        return {\\n            \\\"ok\\\": True,\\n            \\\"command\\\": \\\"stats\\\",\\n            \\\"data\\\": metrics,\\n            \\\"metrics\\\": {\\\"latency_ms\\\": int((time.time() - _start) * 1000)},\\n        }\\n    finally:\\n        svc.close()\"}], \"dependencies\": {\"dependencies\": {}, \"devDependencies\": {}}, \"commands\": [\"python -m scripts.elephant_cli stats\"]}"}
