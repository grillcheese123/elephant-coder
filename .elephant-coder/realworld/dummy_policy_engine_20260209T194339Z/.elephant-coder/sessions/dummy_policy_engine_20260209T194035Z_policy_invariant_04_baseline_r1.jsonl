{"ts": "2026-02-09T19:44:41Z", "session_id": "dummy_policy_engine_20260209T194035Z_policy_invariant_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_208192364929", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T19:44:41Z", "session_id": "dummy_policy_engine_20260209T194035Z_policy_invariant_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_208192364929", "content": "{\"summary\": \"Create docs/quality/invariants.md documenting extension contracts and architectural invariants for registry, processor inheritance, and repository contracts.\", \"project\": {\"language\": \"python\"}, \"files\": [{\"path\": \"docs/quality/invariants.md\", \"content\": \"# Architectural Invariants\\n\\nThis document specifies extension contracts and architectural invariants that must be upheld when extending the Policy Engine.\\n\\n## Registry Contract\\n\\nThe system uses a registry to map channels to processors. The registry must:\\n\\n- Support registration of processors by channel name.\\n- Return a unique processor per channel.\\n- Raise `LookupError` if no processor is registered for a requested channel.\\n\\n## Processor Inheritance Rules\\n\\nAll channel-specific processors must:\\n\\n- Extend `BaseProcessor`.\\n- Set `supported_channel` to the channel they handle (e.g., `\\\"email\\\"`, `\\\"push\\\"`).\\n- Implement `_deliver(item: WorkItem) -> str` with channel-specific side effects.\\n\\nThe `BaseProcessor` provides:\\n\\n- `name`: class name by default.\\n- `supports(item)`: checks `item.channel == supported_channel`.\\n- `process(item)`: validates support, then calls `_deliver`, returning a `RunResult`.\\n\\n## Repository Contract\\n\\nImplementations of `WorkItemRepository` must:\\n\\n- Persist `WorkItem` instances via `save(item)`.\\n- Retrieve items by ID via `get(identifier)`.\\n- List items by channel via `list_by_channel(channel)`.\\n- List all items via `list_all()`.\\n\\nAll methods must be thread-safe and durable for production use.\"}]}}"}
