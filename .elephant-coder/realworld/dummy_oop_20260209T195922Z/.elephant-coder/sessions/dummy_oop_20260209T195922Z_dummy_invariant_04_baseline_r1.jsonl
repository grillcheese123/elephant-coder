{"ts": "2026-02-09T20:00:55Z", "session_id": "dummy_oop_20260209T195922Z_dummy_invariant_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_93f4e4fc75c1", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T20:00:55Z", "session_id": "dummy_oop_20260209T195922Z_dummy_invariant_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_93f4e4fc75c1", "content": "{\n  \"summary\": \"Created docs/quality/invariants.md documenting extension contracts and architectural invariants for the workflow engine: registry contract (register_processors), processor inheritance rules (BaseProcessor as abstract base for all concrete processors), and repository contract (WorkItemRepository interface). Runtime behavior unchanged.\",\n  \"project\": {\n    \"language\": \"python\"\n  },\n  \"files\": [\n    {\n      \"path\": \"docs/quality/invariants.md\",\n      \"content\": \"# Architectural Invariants\\n\\nThis document describes extension contracts and architectural invariants that must be preserved when extending the workflow engine.\\n\\n## Registry Contract\\n\\nThe `register_processors` function in `workflow_engine.runtime.registry` defines the set of default processors. It returns a list of `Processor` instances that must be non-overlapping in channel support.\\n\\n### Invariants\\n- **Distinct Channels**: Each registered processor must support exactly one channel, and no two processors may support the same channel.\\n- **BaseProcessor Subclass**: All default processors must be subclasses of `BaseProcessor` to ensure consistent behavior.\\n\\n### Extension Rules\\n- To add a new processor, implement a subclass of `BaseProcessor` with a unique `supported_channel` value.\\n- Register the new processor in `register_processors` to include it in the default runtime.\\n\\n## Processor Inheritance Rules\\n\\nAll concrete processors must inherit from `BaseProcessor`, which implements the `Processor` contract.\\n\\n### Contract\\n- `Processor.name`: Human-readable name (default: class name).\\n- `Processor.supports(item)`: Returns `True` if `item.channel == self.supported_channel`.\\n- `Processor.process(item)`: Returns `RunResult` with success status and details.\\n\\n### Invariants\\n- **Channel Uniqueness**: Each processor must declare exactly one `supported_channel`.\\n- **Deliver Abstraction**: Subclasses must implement `_deliver(item)` for channel-specific side effects.\\n\\n### Extension Rules\\n- Do not override `supports` or `process` in subclasses; implement `_deliver` instead.\\n- Ensure `_deliver` does not raise unhandled exceptions; failures should be reflected in `RunResult`.\\n\\n## Repository Contract\\n\\nThe `WorkItemRepository` interface defines persistence boundaries for work items.\\n\\n### Contract\\n- `save(item)`: Persist a work item.\\n- `get(identifier)`: Retrieve a work item by ID.\\n- `list_by_channel(channel)`: List items for a specific channel.\\n- `list_all()`: List all stored items.\\n\\n### Invariants\\n- **Consistency**: All methods must be thread-safe or externally synchronized.\\n- **Identity**: `get(identifier)` must return the same item as was saved with that ID.\\n\\n### Extension Rules\\n- New repository implementations must conform to the `WorkItemRepository` interface.\\n- Ensure `save` and `get` maintain consistency with `identifier` and `channel` properties of `WorkItem`.\\n\\n## Summary\\n\\nThese invariants ensure predictable extension behavior and runtime consistency. Adhering to them preserves the dispatcher's ability to route work items correctly and maintain reliable processing results.\"\n    }\n  ],\n  \"dependencies\": {\n    \"dependencies\": {},\n    \"devDependencies\": {},\n    \"python\": [],\n    \"pythonDev\": [],\n    \"rust\": [],\n    \"go\": [],\n    \"cpp\": []\n  },\n  \"commands\": []\n}"}
