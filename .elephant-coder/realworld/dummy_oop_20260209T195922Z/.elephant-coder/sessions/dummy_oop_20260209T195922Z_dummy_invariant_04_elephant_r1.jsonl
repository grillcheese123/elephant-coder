{"ts": "2026-02-09T20:01:05Z", "session_id": "dummy_oop_20260209T195922Z_dummy_invariant_04_elephant_r1", "role": "user", "command": "/code", "run_id": "run_0e4c6ab61b81", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T20:01:05Z", "session_id": "dummy_oop_20260209T195922Z_dummy_invariant_04_elephant_r1", "role": "assistant", "command": "/code", "run_id": "run_0e4c6ab61b81", "content": "```json\n{\n  \"summary\": \"Created docs/quality/invariants.md documenting extension contracts and architectural invariants: registry contract (processor registration and lookup), processor inheritance rules (abstract Processor base, BaseProcessor implementation, concrete processors), and repository contract (WorkItemRepository interface and invariants). Runtime behavior unchanged.\",\n  \"project\": {\n    \"language\": \"python\"\n  },\n  \"files\": [\n    {\n      \"path\": \"docs/quality/invariants.md\",\n      \"content\": \"# Architectural Invariants\\n\\nThis document specifies the extension contracts and architectural invariants that must be preserved when extending the workflow engine.\\n\\n## Registry Contract\\n\\nThe registry is responsible for registering and resolving processor instances by channel.\\n\\n### Interface\\n\\n- `register(processor: Processor) -> None`: Register a processor for its supported channel(s).\\n- `get_processor(channel: str) -> Processor`: Resolve the processor for a given channel.\\n- `list_registered() -> list[str]`: List all registered channel names.\\n\\n### Invariants\\n\\n- Each channel maps to exactly one processor.\\n- Attempting to register a second processor for an existing channel raises `ValueError`.\\n- `get_processor(channel)` raises `LookupError` if no processor is registered for the channel.\\n\\n### Extension Rules\\n\\n- New processors must implement the `Processor` contract.\\n- Processors must declare a unique `name` property.\\n- Processors must implement `supports(item)` to determine applicability.\\n\\n## Processor Inheritance Rules\\n\\nProcessors implement the `Processor` abstract base class and extend `BaseProcessor` for shared behavior.\\n\\n### Abstract Contract (`Processor`)\\n\\n- `name: str`: Human-readable identifier.\\n- `supports(item: WorkItem) -> bool`: Predicate for item eligibility.\\n- `process(item: WorkItem) -> RunResult`: Execute processing logic.\\n\\n### Base Implementation (`BaseProcessor`)\\n\\n- Implements `supports(item)` to check `item.channel == self.name`.\\n- Implements `process(item)` to call `_deliver(item)` and wrap in `RunResult`.\\n- Provides `_deliver(item) -> str`: Abstract delivery method for subclasses.\\n\\n### Concrete Processors\\n\\n- `EmailProcessor`, `SmsProcessor`, `PushProcessor`, `WebhookProcessor` extend `BaseProcessor`.\\n- Each implements `_deliver(item)` with channel-specific delivery logic.\\n- All must preserve the `supports` and `process` invariants.\\n\\n### Invariants\\n\\n- `supports(item)` must be deterministic and idempotent.\\n- `process(item)` must not mutate the input `WorkItem`.\\n- `_deliver(item)` must return a stable identifier for the delivered message.\\n\\n## Repository Contract\\n\\nThe repository abstracts persistence of `WorkItem` instances.\\n\\n### Interface (`WorkItemRepository`)\\n\\n- `save(item: WorkItem) -> None`: Persist an item.\\n- `get(identifier: str) -> WorkItem | None`: Retrieve by ID.\\n- `list_by_channel(channel: str) -> list[WorkItem]`: Filter by channel.\\n- `list_all() -> list[WorkItem]`: Retrieve all items.\\n\\n### Invariants\\n\\n- `save(item)` must persist `item.identifier`, `item.channel`, and `item.payload` atomically.\\n- `get(identifier)` must return the same item if previously saved.\\n- `list_by_channel(channel)` must return only items with matching `item.channel`.\\n- `list_all()` must return all persisted items.\\n\\n### Extension Rules\\n\\n- New repository implementations must preserve all invariants.\\n- Repository must not mutate stored `WorkItem` instances.\\n- Repository operations must be thread-safe if used concurrently.\\n\\n## WorkItem Contract\\n\\nAll work items must satisfy:\\n\\n- `identifier: str`: Unique, immutable, and stable across runs.\\n- `channel: str`: Target delivery channel.\\n- `payload: dict[str, str]`: Message data.\\n\\nExtensions must not alter these properties or their semantics.\"\n    }\n  ],\n  \"dependencies\": {\n    \"dependencies\": {},\n    \"devDependencies\": {},\n    \"python\": [],\n    \"pythonDev\": [],\n    \"rust\": [],\n    \"go\": [],\n    \"cpp\": []\n  },\n  \"commands\": []\n}\n```"}
