{"ts": "2026-02-09T19:41:52Z", "session_id": "dummy_oop_20260209T194035Z_dummy_invariant_04_elephant_r1", "role": "user", "command": "/code", "run_id": "run_b4142cea7e67", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T19:41:52Z", "session_id": "dummy_oop_20260209T194035Z_dummy_invariant_04_elephant_r1", "role": "assistant", "command": "/code", "run_id": "run_b4142cea7e67", "content": "```json\n{\n  \"summary\": \"Created docs/quality/invariants.md documenting extension contracts and architectural invariants for registry, processor inheritance, and repository contracts.\",\n  \"project\": {\n    \"language\": \"python\"\n  },\n  \"files\": [\n    {\n      \"path\": \"docs/quality/invariants.md\",\n      \"content\": \"# Architectural Invariants\\n\\nThis document describes the extension contracts and architectural invariants that ensure consistency and maintainability across the workflow engine.\\n\\n## Registry Contract\\n\\nThe registry is responsible for managing available processors. It must:\\n\\n- Support registration of processors by name\\n- Provide lookup of processors by channel\\n- Raise `LookupError` when no processor supports a given channel\\n\\nThe registry is implemented in `src/workflow_engine/runtime/registry.py` and must be extended when adding new processor types.\\n\\n## Processor Inheritance Rules\\n\\nAll processors must adhere to the following inheritance hierarchy:\\n\\n- `Processor` (abstract base class) defines the contract:\\n  - `name: str` \u2014 human-readable identifier\\n  - `supports(item: WorkItem) -> bool` \u2014 determines applicability\\n  - `process(item: WorkItem) -> RunResult` \u2014 executes processing logic\\n\\n- `BaseProcessor` provides default implementation:\\n  - Implements `supports()` to check channel match\\n  - Implements `process()` to delegate to `_deliver()`\\n  - Defines abstract `_deliver()` for subclasses\\n\\n- Concrete processors (`EmailProcessor`, `SmsProcessor`, `PushProcessor`, `WebhookProcessor`) extend `BaseProcessor` and implement `_deliver()`.\\n\\n**Invariant**: No processor may override `supports()` or `process()` directly; extension must occur via `_deliver()`.\\n\\n## Repository Contract\\n\\nThe repository abstracts persistence for work items:\\n\\n- `WorkItemRepository` (abstract base class) defines:\\n  - `save(item: WorkItem) -> None`\\n  - `get(identifier: str) -> WorkItem | None`\\n  - `list_by_channel(channel: str) -> list[WorkItem]`\\n  - `list_all() -> list[WorkItem]`\\n\\n- Concrete implementations (e.g., `InMemoryRepository`) must preserve:\\n  - Idempotent `save()`\\n  - Consistent `get()` and `list_*()` behavior\\n  - Thread-safety where required\\n\\n## Extension Guidelines\\n\\nTo add a new processor:\\n\\n1. Implement `_deliver()` in a subclass of `BaseProcessor`\\n2. Register it in the registry\\n3. Ensure channel uniqueness\\n\\nTo add a new repository:\\n\\n1. Implement all abstract methods in `WorkItemRepository`\\n2. Preserve contract semantics (e.g., `get()` returns `None` for missing items)\\n\"\n    }\n  ],\n  \"dependencies\": {\n    \"dependencies\": {},\n    \"devDependencies\": {},\n    \"python\": [],\n    \"pythonDev\": [],\n    \"rust\": [],\n    \"go\": [],\n    \"cpp\": []\n  },\n  \"commands\": []\n}\n```"}
