{"ts": "2026-02-09T19:41:42Z", "session_id": "dummy_oop_20260209T194035Z_dummy_invariant_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_75ca17ca3f3f", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T19:41:42Z", "session_id": "dummy_oop_20260209T194035Z_dummy_invariant_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_75ca17ca3f3f", "content": "```json\n{\n  \"summary\": \"Created docs/quality/invariants.md documenting extension contracts and architectural invariants: registry contract (register_processors), processor inheritance rules (BaseProcessor as abstract base for all processors, requiring supported_channel and _deliver), and repository contract (WorkItemRepository interface). Runtime behavior unchanged.\",\n  \"project\": {\n    \"language\": \"python\"\n  },\n  \"files\": [\n    {\n      \"path\": \"docs/quality/invariants.md\",\n      \"content\": \"# Architectural Invariants\\n\\nThis document describes the extension contracts and architectural invariants that ensure correctness and extensibility of the workflow engine.\\n\\n## Registry Contract\\n\\nThe registry contract is implemented by `register_processors` in `src/workflow_engine/runtime/registry.py`. It defines how processors are registered into a runtime dispatcher.\\n\\n### Invariants\\n- Only `Processor` instances may be registered.\\n- Each registered processor must support exactly one distinct channel.\\n- The default runtime (`build_default_runtime`) registers all channel-specific processors (email, sms, push, webhook) via `register_processors`.\\n\\n## Processor Inheritance Rules\\n\\nAll processors must inherit from `BaseProcessor`, which enforces the following contract:\\n\\n### Abstract Requirements\\n- `supported_channel: str` class attribute must be set to a non-empty string.\\n- `_deliver(item: WorkItem) -> str` must be implemented for channel-specific side effects.\\n\\n### Inherited Behavior\\n- `name` property returns the class name.\\n- `supports(item)` returns `True` only if `item.channel == supported_channel`.\\n- `process(item)` delegates to `_deliver` only when supported; otherwise returns a failure `RunResult`.\\n\\n### Invariants\\n- No processor may override `supports` or `process` (only `_deliver` is extensible).\\n- All processors must be subclasses of `BaseProcessor` (verified by `test_default_processors_are_base_processor_subclasses`).\\n- Each processor must declare a unique `supported_channel` (verified by `test_channels_are_distinct`).\\n\\n## Repository Contract\\n\\nThe repository contract is defined by `WorkItemRepository` in `src/workflow_engine/contracts/repository.py`.\\n\\n### Required Methods\\n- `save(item: WorkItem) -> None`\\n- `get(identifier: str) -> WorkItem | None`\\n- `list_by_channel(channel: str) -> list[WorkItem]`\\n- `list_all() -> list[WorkItem]`\\n\\n### Invariants\\n- Implementations must preserve item identity via `identifier`.\\n- `list_by_channel` must return only items where `item.channel == channel`.\\n- `save` must not mutate the input item.\\n\\n## Extension Points\\n\\n- New processors: subclass `BaseProcessor`, set `supported_channel`, implement `_deliver`.\\n- New repositories: implement `WorkItemRepository` interface.\\n- New work item types: subclass `WorkItem` and implement `identifier`, `channel`, `payload`.\\n\\nAll extensions must preserve the invariants above to maintain runtime correctness.\"\n    }\n  ],\n  \"dependencies\": {\n    \"dependencies\": {},\n    \"devDependencies\": {},\n    \"python\": [],\n    \"pythonDev\": [],\n    \"rust\": [],\n    \"go\": [],\n    \"cpp\": []\n  },\n  \"commands\": []\n}\n```"}
