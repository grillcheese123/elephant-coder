{"ts": "2026-02-09T19:48:42Z", "session_id": "dummy_cross_module_20260209T194035Z_cross_invariant_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_3626a8d6914f", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (delivery interface contract, cross-module processor hierarchy, registry contract, repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T19:48:42Z", "session_id": "dummy_cross_module_20260209T194035Z_cross_invariant_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_3626a8d6914f", "content": "{\"summary\": \"Create docs/quality/invariants.md documenting extension contracts and architectural invariants: DeliveryInterface, cross-module processor hierarchy (Processor, ChannelBoundProcessor, PushProcessor, ReliableProcessor), ProcessorRegistry, and WorkItemRepository. Runtime behavior unchanged.\", \"project\": {\"language\": \"python\"}, \"files\": [{\"path\": \"docs/quality/invariants.md\", \"content\": \"# Architectural Invariants\\n\\nThis document describes the extension contracts and architectural invariants that ensure consistent behavior across the cross-module engine.\\n\\n## Delivery Interface Contract\\n\\nThe `DeliveryInterface` defines the contract for channel adapters used by processors to emit messages.\\n\\n### Contract\\n\\n- **channel**: Read-only property returning the channel identifier (e.g., `\\\"email\\\"`, `\\\"push\\\"`).\\n- **emit(message: str) -> str**: Emit a rendered message and return the final delivery payload.\\n\\n### Implementation\\n\\n`DeliveryAdapter` implements `DeliveryInterface` and uses `MessageTemplate` to prefix messages with the channel name.\\n\\n```python\\nclass DeliveryInterface(ABC):\\n    @property\\n    @abstractmethod\\n    def channel(self) -> str: ...\\n\\n    @abstractmethod\\n    def emit(self, message: str) -> str: ...\\n```\\n\\n## Cross-Module Processor Hierarchy\\n\\nProcessors form a hierarchy with clear responsibilities and extension points.\\n\\n### Base Processor Contract\\n\\n`Processor` is the abstract base for all processors.\\n\\n- **name**: Human-readable processor name.\\n- **supports(item: WorkItem) -> bool**: Determine if the processor can handle the item.\\n- **process(item: WorkItem) -> RunResult**: Execute processing and return a result.\\n\\n### Channel-Bound Processor\\n\\n`ChannelBoundProcessor` extends `BaseProcessor` and encapsulates delivery concerns.\\n\\n- **adapter**: Returns a `DeliveryInterface` instance for channel-specific delivery.\\n- **render_message(item: WorkItem) -> str**: Render the message using the adapter's template.\\n- **_deliver(item: WorkItem) -> str**: Deliver the rendered message via the adapter.\\n\\n### Push Processor\\n\\n`PushProcessor` implements `Processor` directly and delegates delivery to a `DeliveryAdapter`.\\n\\n- **name**: Returns `\\\"PushProcessor\\\"`.\\n- **supports**: Returns `True` only for `\\\"push\\\"` channel items.\\n- **process**: Renders and emits the message, returning a `RunResult`.\\n\\n### Reliable Processor\\n\\n`ReliableProcessor` extends `ChannelBoundProcessor` to add reliability semantics (e.g., retries) while preserving the delivery interface contract.\\n\\n- **process**: Wraps `_deliver` with reliability logic.\\n\\n## Registry Contract\\n\\n`ProcessorRegistry` manages processor selection and discovery.\\n\\n### Contract\\n\\n- **get_processor(item: WorkItem) -> Processor**: Return the processor that supports the item.\\n- **list_all() -> list[Processor]**: Return all registered processors.\\n\\n### Implementation\\n\\nThe registry maps channels to processors and raises `LookupError` if no processor supports the item.\\n\\n## Repository Contract\\n\\n`WorkItemRepository` defines persistence boundaries for work items.\\n\\n### Contract\\n\\n- **save(item: WorkItem) -> None**: Persist an item.\\n- **get(identifier: str) -> WorkItem | None**: Retrieve an item by ID.\\n- **list_by_channel(channel: str) -> list[WorkItem]**: List items for a channel.\\n- **list_all() -> list[WorkItem]**: List all stored items.\\n\\nThis contract ensures decoupling between processing logic and persistence mechanisms.\"}], \"dependencies\": {\"dependencies\": {}, \"devDependencies\": {}, \"python\": [], \"pythonDev\": [], \"rust\": [], \"go\": [], \"cpp\": []}, \"commands\": []}"}
