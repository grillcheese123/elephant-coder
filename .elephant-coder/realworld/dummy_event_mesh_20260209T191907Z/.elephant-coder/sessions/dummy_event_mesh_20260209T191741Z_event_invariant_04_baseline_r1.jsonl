{"ts": "2026-02-09T19:20:47Z", "session_id": "dummy_event_mesh_20260209T191741Z_event_invariant_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_d6b2005a338b", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T19:20:47Z", "session_id": "dummy_event_mesh_20260209T191741Z_event_invariant_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_d6b2005a338b", "content": "{\"summary\": \"Create docs/quality/invariants.md documenting extension contracts and architectural invariants: registry contract, processor inheritance rules, and repository contract, preserving existing runtime behavior.\", \"project\": {\"language\": \"python\"}, \"files\": [{\"path\": \"docs/quality/invariants.md\", \"content\": \"# Architectural Invariants\\n\\nThis document specifies extension contracts and architectural invariants for the Event Mesh engine.\\n\\n## Extension Points\\n\\n### Registry Contract\\n\\nThe system uses a registry to manage available processors. While no explicit registry interface is defined, the following invariants must hold:\\n\\n- **Processor registration**: Each processor must be registered in `src/event_mesh/processors/__init__.py` via `__all__` and imports.\\n- **Channel uniqueness**: Each processor must support exactly one channel (`supported_channel`), and no two active processors may support the same channel.\\n- **Discovery**: The runtime discovers processors by inspecting the `processors` package; new processors must be added to `__init__.py` to be discoverable.\\n\\n### Processor Inheritance Rules\\n\\nAll channel-specific processors must adhere to the following inheritance contract:\\n\\n- **Base class**: Extend `BaseProcessor` (not `Processor` directly).\\n- **Channel binding**: Set `supported_channel` class attribute to a non-empty string matching the target channel.\\n- **Override `_deliver`**: Implement `_deliver(item: WorkItem) -> str` for channel-specific side effects.\\n- **Invariants preserved**:\\n  - `supports(item)` returns `True` iff `item.channel == self.supported_channel`.\\n  - `process(item)` returns a `RunResult` with `success=True` and `_deliver` output on success, or `success=False` with an error message on channel mismatch.\\n\\n### Repository Contract\\n\\nThe `WorkItemRepository` interface defines persistence boundaries:\\n\\n- **Methods**:\\n  - `save(item)`: Persist a work item.\\n  - `get(identifier)`: Retrieve by ID, return `None` if not found.\\n  - `list_by_channel(channel)`: Return all items targeting a channel.\\n  - `list_all()`: Return all stored items.\\n- **Invariants**:\\n  - `save` must be idempotent for the same item.\\n  - `get` must return the same item if called with the same ID after `save`.\\n  - `list_by_channel` and `list_all` must reflect all items persisted via `save`.\\n\\n## Extension Guidelines\\n\\n- **Adding a new processor**:\\n  1. Create a subclass of `BaseProcessor` with `supported_channel` set.\\n  2. Implement `_deliver`.\\n  3. Add to `processors/__init__.py` imports and `__all__`.\\n- **Adding a new repository implementation**:\\n  1. Implement `WorkItemRepository`.\\n  2. Ensure all invariants above hold.\\n  3. Integrate with runtime via dependency injection (if supported).\\n\\n## Runtime Behavior\\n\\nAll invariants are designed to preserve existing runtime behavior:\\n\\n- Dispatching a ticket to an unregistered channel (e.g., `push`) raises `LookupError` if no processor supports it.\\n- Processors return `RunResult` objects with `success` and `details` fields as implemented in `BaseProcessor`.\\n- No changes to runtime behavior are introduced by this document.\"}]"}
