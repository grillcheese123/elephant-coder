{"ts": "2026-02-09T20:12:30Z", "session_id": "dummy_oop_20260209T200944Z_dummy_invariant_04_baseline_r1", "role": "user", "command": "/code", "run_id": "run_e16351440e32", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (registry contract, processor inheritance rules, and repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T20:12:30Z", "session_id": "dummy_oop_20260209T200944Z_dummy_invariant_04_baseline_r1", "role": "assistant", "command": "/code", "run_id": "run_e16351440e32", "content": "```json\n{\n  \"summary\": \"Created docs/quality/invariants.md documenting extension contracts and architectural invariants for the workflow engine: registry contract, processor inheritance rules (BaseProcessor subclassing), and repository contract.\",\n  \"project\": {\n    \"language\": \"python\"\n  },\n  \"files\": [\n    {\n      \"path\": \"docs/quality/invariants.md\",\n      \"content\": \"# Architectural Invariants\\n\\nThis document specifies extension contracts and architectural invariants for the workflow engine.\\n\\n## Registry Contract\\n\\nThe `register_processors` function in `src/workflow_engine/runtime/registry.py` defines the registry contract:\\n\\n- Registers all built-in processors into the `DispatcherService`\\n- Ensures each processor is a subclass of `BaseProcessor`\\n- Enforces distinct channel assignments (no overlapping channels)\\n- Must be called during runtime bootstrap before dispatching items\\n\\n## Processor Inheritance Rules\\n\\nAll processors must adhere to the following inheritance hierarchy:\\n\\n- `Processor` (abstract contract in `src/workflow_engine/contracts/processor.py`)\\n  - `BaseProcessor` (abstract base class in `src/workflow_engine/processors/base_processor.py`)\\n    - `EmailProcessor`\\n    - `SmsProcessor`\\n    - `PushProcessor`\\n    - `WebhookProcessor`\\n\\n### Required Overrides\\n\\n- `BaseProcessor` subclasses must set `supported_channel` class attribute\\n- `_deliver(item: WorkItem) -> str` must be implemented by each concrete processor\\n- `name` property defaults to `__class__.__name__`\\n- `supports(item)` checks `item.channel == self.supported_channel`\\n\\n### Invariant Enforcement\\n\\n- `BaseProcessor.process()` validates channel support before calling `_deliver`\\n- Processors must not modify work item state (immutability via `@dataclass(frozen=True)`)\\n\\n## Repository Contract\\n\\nThe `WorkItemRepository` abstract contract in `src/workflow_engine/contracts/repository.py` defines:\\n\\n- `save(item: WorkItem) -> None`: Persist work item\\n- `get(identifier: str) -> WorkItem | None`: Retrieve by ID\\n- `list_by_channel(channel: str) -> list[WorkItem]`: Query by channel\\n- `list_all() -> list[WorkItem]`: Full scan\\n\\n### Implementation Requirements\\n\\n- Concrete repositories (e.g., `InMemoryWorkItemRepository`) must implement all abstract methods\\n- Repository implementations must preserve work item immutability\\n- No business logic allowed in repository layer\\n\\n## Extension Points\\n\\n### Adding New Processors\\n\\n1. Subclass `BaseProcessor`\\n2. Set `supported_channel` to a unique channel name\\n3. Implement `_deliver(item: WorkItem) -> str`\\n4. Register in `src/workflow_engine/runtime/registry.py`\\n5. Add tests verifying channel distinctness and dispatch behavior\\n\\n### Adding New Repositories\\n\\n1. Subclass `WorkItemRepository`\\n2. Implement all abstract methods\\n3. Ensure thread-safety if required\\n4. Maintain work item immutability guarantees\\n\"\n    }\n  ],\n  \"dependencies\": {\n    \"dependencies\": {},\n    \"devDependencies\": {},\n    \"python\": [],\n    \"pythonDev\": [],\n    \"rust\": [],\n    \"go\": [],\n    \"cpp\": []\n  },\n  \"commands\": []\n}\n```"}
