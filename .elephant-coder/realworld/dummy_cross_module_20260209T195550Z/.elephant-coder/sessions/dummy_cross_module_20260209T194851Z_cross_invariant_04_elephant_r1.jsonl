{"ts": "2026-02-09T19:58:37Z", "session_id": "dummy_cross_module_20260209T194851Z_cross_invariant_04_elephant_r1", "role": "user", "command": "/code", "run_id": "run_372c6e9ec919", "content": "Create docs/quality/invariants.md describing extension contracts and architectural invariants (delivery interface contract, cross-module processor hierarchy, registry contract, repository contract). Keep runtime behavior unchanged."}
{"ts": "2026-02-09T19:58:37Z", "session_id": "dummy_cross_module_20260209T194851Z_cross_invariant_04_elephant_r1", "role": "assistant", "command": "/code", "run_id": "run_372c6e9ec919", "content": "{\"summary\": \"Created docs/quality/invariants.md documenting four architectural invariants: DeliveryInterface contract, ChannelBoundProcessor hierarchy, Registry contract, and WorkItemRepository contract. No runtime behavior changed.\", \"project\": {\"language\": \"python\"}, \"files\": [{\"path\": \"docs/quality/invariants.md\", \"content\": \"# Architectural Invariants\\n\\nThis document specifies the extension contracts and architectural invariants that must be preserved across the cross-module engine.\\n\\n---\\n\\n## Delivery Interface Contract\\n\\n**Location:** `src/cross_module_engine/interfaces/delivery_interface.py`\\n\\nThe `DeliveryInterface` defines the minimal contract for channel delivery adapters:\\n\\n- `channel: str` \u2014 read-only property identifying the delivery channel.\\n- `emit(message: str) -> str` \u2014 transforms and dispatches a message, returning the final payload.\\n\\nImplementations:\\n- `DeliveryAdapter` \u2014 concrete adapter that uses a `MessageTemplate` to format messages.\\n\\nInvariants:\\n- All adapters must be immutable with respect to channel identity.\\n- `emit` must be pure (no side effects) and deterministic for the same input.\\n\\n---\\n\\n## Cross-Module Processor Hierarchy\\n\\n**Location:** `src/cross_module_engine/processors/`\\n\\n### Base Contract\\n\\n- `Processor` (abstract) \u2014 defines `name`, `supports`, and `process` methods.\\n\\n### Channel-Bound Base\\n\\n- `ChannelBoundProcessor` extends `Processor` and adds:\\n  - `adapter: DeliveryInterface` \u2014 lazily resolved delivery adapter.\\n  - `render_message(item: WorkItem) -> str` \u2014 formats the message using the adapter.\\n  - `_deliver(item: WorkItem) -> str` \u2014 invokes `adapter.emit` and returns the result.\\n\\n### Concrete Processors\\n\\n- `PushProcessor` \u2014 handles `push` channel items.\\n- `ReliableProcessor` \u2014 wraps delivery in reliability semantics (e.g., retries).\\n\\nInvariants:\\n- All processors must be stateless except for the adapter reference.\\n- `supports` must be deterministic and based solely on `WorkItem.channel`.\\n- `process` must delegate to `_deliver` and wrap the result in a `RunResult`.\\n\\n---\\n\\n## Registry Contract\\n\\n**Location:** `src/cross_module_engine/runtime/registry.py`\\n\\nThe registry is responsible for routing work items to the correct processor:\\n\\n- `register(processor: Processor)` \u2014 adds a processor by name.\\n- `get_processor(channel: str) -> Processor` \u2014 resolves the processor for a channel.\\n- `process(item: WorkItem) -> RunResult` \u2014 dispatches an item to the appropriate processor.\\n\\nInvariants:\\n- The registry must be immutable after initialization.\\n- `process` must raise `LookupError` if no processor supports the item\u2019s channel.\\n- All registered processors must be mutually exclusive in `supports` (no ambiguous matches).\\n\\n---\\n\\n## Repository Contract\\n\\n**Location:** `src/cross_module_engine/contracts/repository.py`\\n\\nThe `WorkItemRepository` defines the persistence boundary:\\n\\n- `save(item: WorkItem) -> None`\\n- `get(identifier: str) -> WorkItem | None`\\n- `list_by_channel(channel: str) -> list[WorkItem]`\\n- `list_all() -> list[WorkItem]`\\n\\nInvariants:\\n- Repository operations must be idempotent for `save` and `get`.\\n- `list_by_channel` must return only items matching the exact channel.\\n- No repository implementation is required for runtime; it is an extension point.\\n\\n---\\n\\n## Extension Guidelines\\n\\n- New channels require a new `Processor` subclass and a corresponding `DeliveryInterface` implementation.\\n- The registry must be updated to register new processors.\\n- All contracts must remain stable to preserve runtime behavior.\\n\"}], \"dependencies\": {\"dependencies\": {}, \"devDependencies\": {}, \"python\": [], \"pythonDev\": [], \"rust\": [], \"go\": [], \"cpp\": []}, \"commands\": []}"}
