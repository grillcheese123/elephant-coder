{
  "protocol_version": "v1-dummy-layered-inheritance",
  "description": "Synthetic layered-inheritance benchmark tasks on a deep hierarchy fixture.",
  "tasks": [
    {
      "task_id": "layered_summary_01",
      "category": "analysis",
      "prompt": "Create docs/summary/project_architecture.md. Summarize the repository with a file map, abstract contracts, layered inheritance chain, and dispatch flow. Follow source-code rules and naming. Ensure the file is at least 220 characters.",
      "checks": [
        "uv run --python 3.12 python -c \"from pathlib import Path; import sys; p=Path('docs/summary/project_architecture.md'); text=p.read_text(encoding='utf-8', errors='replace') if p.exists() else ''; low=text.lower(); keys=['workitem','processor','baseprocessor','guardedprocessor','prioritizedprocessor','dispatcher']; hits=sum(1 for k in keys if k in low); sys.exit(0 if p.exists() and len(text)>=200 and hits>=4 else 1)\""
      ],
      "expected_files": [
        "docs/summary/project_architecture.md"
      ]
    },
    {
      "task_id": "layered_feature_02",
      "category": "feature",
      "prompt": "Add push notification support by following existing layered source-code rules and extension patterns. Create src/layered_engine/processors/push_processor.py with class PushProcessor, implement policy and deliver logic, update src/layered_engine/processors/__init__.py and src/layered_engine/runtime/registry.py, and add tests/test_push_processor.py using unittest for successful dispatch.",
      "checks": [
        "uv run --python 3.12 python -m py_compile src/layered_engine/processors/push_processor.py src/layered_engine/runtime/registry.py tests/test_push_processor.py",
        "uv run --python 3.12 python -c \"from pathlib import Path; import re, sys; p=Path('src/layered_engine/processors/push_processor.py'); text=p.read_text(encoding='utf-8', errors='replace') if p.exists() else ''; ok=bool(re.search(r'class\\\\s+PushProcessor\\\\s*\\\\(\\\\s*PrioritizedProcessor\\\\s*\\\\)', text)); sys.exit(0 if ok else 1)\"",
        "uv run --python 3.12 python -c \"from pathlib import Path; import sys; text=Path('src/layered_engine/runtime/registry.py').read_text(encoding='utf-8', errors='replace'); sys.exit(0 if 'PushProcessor' in text else 1)\"",
        "uv run --python 3.12 python -m unittest discover -s tests -p \"test_push_processor.py\" -v"
      ],
      "expected_files": [
        "src/layered_engine/processors/push_processor.py",
        "src/layered_engine/processors/__init__.py",
        "src/layered_engine/runtime/registry.py",
        "tests/test_push_processor.py"
      ]
    },
    {
      "task_id": "layered_feature_03",
      "category": "feature",
      "prompt": "Create run_dispatch_demo.py that uses build_default_runtime, dispatches one email ticket, then attempts one push ticket. If push is not available, catch LookupError and continue. Print concise per-channel summary and include audit detail snippets.",
      "checks": [
        "uv run --python 3.12 python -m py_compile run_dispatch_demo.py",
        "uv run --python 3.12 python -c \"from pathlib import Path; import sys; p=Path('run_dispatch_demo.py'); text=p.read_text(encoding='utf-8', errors='replace') if p.exists() else ''; req=['build_default_runtime','LookupError','email']; sys.exit(0 if p.exists() and all(x in text for x in req) else 1)\"",
        "uv run --python 3.12 python -c \"import runpy, sys; sys.path.insert(0, 'src'); runpy.run_path('run_dispatch_demo.py', run_name='__main__')\""
      ],
      "expected_files": [
        "run_dispatch_demo.py"
      ]
    },
    {
      "task_id": "layered_invariant_04",
      "category": "quality",
      "prompt": "Create docs/quality/invariants.md describing layered extension contracts and architectural invariants (policy contract, processor hierarchy, registry contract, repository contract). Keep runtime behavior unchanged.",
      "checks": [
        "uv run --python 3.12 python -c \"from pathlib import Path; import sys; p=Path('docs/quality/invariants.md'); text=p.read_text(encoding='utf-8', errors='replace') if p.exists() else ''; low=text.lower(); sys.exit(0 if p.exists() and len(text) >= 140 and 'prioritizedprocessor' in low and 'guardedprocessor' in low else 1)\"",
        "uv run --python 3.12 python -c \"import sys; sys.path.insert(0, 'src'); from layered_engine.runtime.registry import default_processors; from layered_engine.processors.prioritized_processor import PrioritizedProcessor; ps=default_processors(); sys.exit(0 if isinstance(ps, list) and len(ps) >= 3 and all(isinstance(p, PrioritizedProcessor) for p in ps) else 1)\"",
        "uv run --python 3.12 python -m unittest discover -s tests -p \"test_layering.py\" -v"
      ],
      "expected_files": [
        "docs/quality/invariants.md"
      ]
    }
  ]
}
